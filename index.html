
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Elegance — Papiers Peints</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Wrap everything to avoid interfering with site header/footer -->
  <div id="ew" style="--header-h:0px">
    <!-- HERO -->
    <section class="hero">
      <div class="overlay"></div>
      <div class="content container">
        <h1>Papiers peints d’exception</h1>
        <p class="text">Prestige, 3D, Gold : vos intérieurs méritent un décor à la mesure de vos attentes.</p>
      </div>
    </section>

    <!-- Collections -->
    <section class="section">
      <div class="container">
        <div class="collections-head">
          <h2>Collections</h2>
          <div class="filters">
            <a class="filter text" href="prestige.html">Prestige</a>
            <a class="filter text" href="collection-3d.html">3D</a>
            <a class="filter text" href="gold.html">Gold</a>
          </div>
        </div>
        <div class="grid">
          <a class="card" href="prestige.html">
            <img src="https://static.wixstatic.com/media/d77542_fe3d4bf7270746ca91adab75028f8e96~mv2.png" alt="Prestige">
            <div class="overlay"></div><div class="meta"><h3>Prestige</h3><span class="chip">Voir</span></div>
          </a>
          <a class="card" href="collection-3d.html">
            <img src="https://static.wixstatic.com/media/d77542_50d7633186c141a79a57e2549d69c278~mv2.png" alt="3D">
            <div class="overlay"></div><div class="meta"><h3>3D</h3><span class="chip">Voir</span></div>
          </a>
          <a class="card" href="gold.html">
            <img src="https://static.wixstatic.com/media/d77542_74d9f4d77e5a44819123f2b70d71030b~mv2.png" alt="Gold">
            <div class="overlay"></div><div class="meta"><h3>Gold</h3><span class="chip">Voir</span></div>
          </a>
        </div>
      </div>
    </section>

    <!-- Configurateur 3D -->
    <section class="section config" id="configurateur">
      <div class="container">
        <div class="header-collection">
          <h2>Personnaliser son papier peint</h2>
          <p class="muted text">Importez votre motif, ajustez l’échelle et l’orientation, visualisez en 3D.</p>
        </div>
        <div class="wrap">
          <div class="panel">
            <h3>Réglages</h3>
            <div class="label">Motif</div>
            <div class="row">
              <button class="btn" id="uploadBtn">Importer une image</button>
              <input id="fileInput" type="file" accept="image/*" style="display:none"/>
            </div>
            <div class="label">Échelle</div>
            <input id="scale" type="range" min="20" max="300" value="100"/>
            <div class="label">Rotation</div>
            <input id="rotation" type="range" min="-180" max="180" value="0"/>
            <div class="label">Position</div>
            <div class="row">
              <input id="offx" type="number" value="0" step="10" style="max-width:120px"/> 
              <input id="offy" type="number" value="0" step="10" style="max-width:120px"/>
            </div>
            <div class="label">Perspective (angle)</div>
            <input id="angle" type="range" min="-35" max="0" value="-18"/>
            <div class="row" style="margin-top:8px">
              <button class="btn" id="reset">Réinitialiser</button>
              <button class="btn primary" id="download">Télécharger l’aperçu</button>
            </div>
          </div>
          <div class="stage3d">
            <div class="room3d">
              <div class="wall3d"><canvas id="canvas3d"></canvas></div>
              <div class="controls3d text">Glisser = déplacer • Molette = zoom</div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- JS du configurateur (aucun listener passif qui appelle preventDefault) -->
  <script>
    (function(){
      const root = document.getElementById('ew');
      const canvas = root.querySelector('#canvas3d');
      const ctx = canvas.getContext('2d');
      function fit(){ const w = canvas.parentElement.clientWidth; const h = canvas.parentElement.clientHeight; canvas.width=w; canvas.height=h; draw(true); }
      window.addEventListener('resize', fit); fit();

      const state = { img:null, scale:1, rot:0, ox:0, oy:0 };
      const rotateInput = root.querySelector('#rotation');
      const scaleInput = root.querySelector('#scale');
      const offx = root.querySelector('#offx');
      const offy = root.querySelector('#offy');
      const angle = root.querySelector('#angle');
      angle.addEventListener('input', ()=>{ root.querySelector('.wall3d').style.transform = `rotateY(${angle.value}deg)`; });

      root.querySelector('#uploadBtn').addEventListener('click', ()=> root.querySelector('#fileInput').click());
      root.querySelector('#fileInput').addEventListener('change', e=>{
        const f = e.target.files[0]; if(!f) return;
        const url = URL.createObjectURL(f);
        const img = new Image(); img.onload=()=>{ state.img = img; URL.revokeObjectURL(url); draw(true); };
        img.src = url;
      });

      [rotateInput, scaleInput, offx, offy].forEach(el=> el.addEventListener('input', ()=>{
        state.rot = parseFloat(rotateInput.value) * Math.PI/180;
        state.scale = parseFloat(scaleInput.value)/100;
        state.ox = parseFloat(offx.value)||0; state.oy = parseFloat(offy.value)||0;
        draw();
      }));

      root.querySelector('#reset').addEventListener('click', ()=>{
        scaleInput.value=100; rotateInput.value=0; offx.value=0; offy.value=0; angle.value=-18;
        state.scale=1; state.rot=0; state.ox=0; state.oy=0; root.querySelector('.wall3d').style.transform = `rotateY(-18deg)`; draw(true);
      });
      root.querySelector('#download').addEventListener('click', ()=>{
        const a=document.createElement('a'); a.download='aperçu-3d.png'; a.href=canvas.toDataURL('image/png',0.95); a.click();
      });

      function draw(snap){
        const w = canvas.width, h=canvas.height;
        ctx.clearRect(0,0,w,h);
        ctx.fillStyle='#efefef'; ctx.fillRect(0,0,w,h);
        if(!state.img) return;
        ctx.save();
        ctx.translate(w/2, h/2);
        ctx.rotate(state.rot);
        ctx.scale(state.scale, state.scale);
        ctx.translate(state.ox, state.oy);
        const pat = ctx.createPattern(state.img, 'repeat');
        ctx.fillStyle = pat;
        const R = Math.hypot(w,h)*2;
        ctx.fillRect(-R, -R, R*2, R*2);
        ctx.restore();
        if(snap){ canvas.animate([{opacity:.6},{opacity:1}], {duration:180, easing:'ease-out'}); }
      }

      // Drag & zoom
      let dragging=false, lastX=0, lastY=0;
      canvas.addEventListener('mousedown', e=>{ dragging=true; lastX=e.clientX; lastY=e.clientY; });
      window.addEventListener('mouseup', ()=> dragging=false);
      window.addEventListener('mousemove', e=>{
        if(!dragging) return;
        const dx=e.clientX-lastX, dy=e.clientY-lastY;
        state.ox += dx/(80/state.scale);
        state.oy += dy/(80/state.scale);
        offx.value=Math.round(state.ox);
        offy.value=Math.round(state.oy);
        lastX=e.clientX; lastY=e.clientY;
        draw();
      });
      canvas.addEventListener('wheel', e=>{
        e.preventDefault();
        const delta = -Math.sign(e.deltaY)*0.06;
        state.scale=Math.max(.2, Math.min(3, state.scale+delta));
        scaleInput.value=Math.round(state.scale*100);
        draw();
      }, {passive:false});
    })();
  </script>
</body>
</html>
